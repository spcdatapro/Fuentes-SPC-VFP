PARAMETERS FECINI,FECFIN

*!*	PUBLIC fecini,fecfin

*!*	DO FORM ranfechas

CREATE CURSOR corte_mes(fecha d, sys_efectivo n(10,2), sys_dolar n(10,2), v_credo n(10,2), c_credo n(10,2), r_credo n(10,2), l_credo n(10,2), v_visa n(10,2), c_visa n(10,2), r_visa n(10,2), l_visa n(10,2), ;
	factura_manual n(10,2), dif_sys n(10,2), tot_sys n(10,2), deposito n(10,2), m_dolares  n(10,2), m_tarjeta n(10,2), descuento n(10,2), exencion n(10,2), credito n(10,2), tot_manual n(10,2), diferencia n(10,2), ;
	propina  n(10,2), venta_bruta n(10,2), iva n(10,2), venta_neta n(10,2), venta_neta2 n(10,2), fac_del  n(10), fac_al n(10), emitidas n(10), vrest n(10,2), vdomicilio n(10,2), vtraer n(10,2),;
	pro_credo n(10,2), vb_credo n(10,2), iva_credo n(10,2), pro_visa n(10,2), vb_visa n(10,2), iva_visa n(10,2))

xverhisto=0

DO WHILE fecini<=fecfin
	
	xventa_rest = 0.00
	xventa_domicilio = 0.00
	xventa_traer = 0.00
	
	efefin = 0.00
	tarfin = 0.00
	otrfin = 0.00
	totfin = 0.00

	*xcad = "and BETWEEN(a.fecha,fecini,fecfin)"
	xcad = "and a.fecha=fecini "
	XCAD2 = ""
	xcad3 = ""
	
	** COMANDAS DEL TURNO
	IF xverhisto=0
		SELECT * FROM comanda ORDER BY comanda INTO CURSOR Lascomandas
	ELSE
		SELECT * FROM comanda ORDER BY comanda INTO CURSOR Lascomandas1
		
		SELECT * FROM hist_comanda ORDER BY comanda INTO CURSOR Lascomandas2
				
		SELECT * FROM lascomandas1 UNION ALL ;
		SELECT * FROM lascomandas2 ORDER BY comanda INTO CURSOR lascomandas
	ENDIF
			
	** FACTURAS DEL TURNO
	IF xverhisto=0
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=1 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURFAC
		*SUM ALL TOTAL+PROPINA-DESCUENTO TO MONTOFAC
		SUM ALL TOTAL+PROPINA TO MONTOFAC
		
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=2 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURREC
		*SUM ALL TOTAL+PROPINA-DESCUENTO TO MONTOREC
		SUM ALL TOTAL+PROPINA TO MONTOREC
	ELSE
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=1 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURFAC1
		
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=2 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURREC1
		
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM hist_FACTURA A, hist_comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=1 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURFAC2
		
		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA,a.comanda,serie;
		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND a.tipo=2 &XCAD ;
		ORDER BY factura;
		INTO CURSOR MICURREC2
		
		SELECT * FROM micurfac1 UNION ALL;
		SELECT * FROM micurfac2 ORDER BY factura INTO CURSOR micurfac
		*SUM ALL TOTAL+PROPINA-DESCUENTO TO MONTOFAC
		SUM ALL TOTAL+PROPINA TO MONTOFAC
		
		SELECT * FROM micurrec1 UNION ALL;
		SELECT * FROM micurrec2 ORDER BY factura INTO CURSOR micurrec
		*SUM ALL TOTAL+PROPINA-DESCUENTO TO MONTOREC
		SUM ALL TOTAL+PROPINA TO MONTOREC
		
	ENDIF
		
			
*!*		SELECT A.FACTURA,C.IDENTIFICADOR,A.FECHA,A.CLIENTE,A.A_NOMBRE,IIF(a.ANULADA,000000000.00,A.TOTAL) AS TOTAL,;
*!*		IIF(a.ANULADA,0000000.00,A.DESCUENTO) AS DESCUENTO,IIF(a.ANULADA,0000000.00,A.PROPINA) AS PROPINA,b.turno,A.ANULADA;
*!*		FROM FACTURA A, comanda b, detalle_salon c,lascomandas e ;
*!*		WHERE a.comanda=b.comanda AND a.comanda=e.comanda AND b.mesa=c.mesa AND BETWEEN(a.fecha,fecini,fecfin) &XCAD ;
*!*		ORDER BY factura;
*!*		INTO CURSOR MICURFAC
*!*		SUM ALL TOTAL TO MONTOFAC	
	
	STORE "" TO stitulofacrec
	SELECT distinct serie as serie FROM micurfac INTO CURSOR laserfac
	SELECT laserfac
	SCAN
		IF EMPTY(stitulofacrec)
			SELECT * FROM micurfac WHERE ALLTRIM(serie)==ALLTRIM(laserfac.serie) ORDER BY factura INTO CURSOR scanserie
			SELECT scanserie
			SUM ALL total+propina-descuento TO totfacser
			
			SELECT scanserie
			GO TOP
			DEFACser=scanserie.FACTURA
			GO BOTT
			AFACser=scanserie.FACTURA
			
			STORE stitulofacrec+PADR("FACTURAS SERIE '"+ALLTRIM(laserfac.serie)+"' DEL "+ALLTRIM(STR(defacser))+" AL "+ALLTRIM(STR(afacser)),40)+PADL(ALLTRIM(STR(totfacser,10,2)),14) TO stitulofacrec
			
		ELSE
			SELECT * FROM micurfac WHERE ALLTRIM(serie)==ALLTRIM(laserfac.serie) ORDER BY factura INTO CURSOR scanserie
			SELECT scanserie
			SUM ALL total+propina-descuento TO totfacser
			
			SELECT scanserie
			GO TOP
			DEFACser=scanserie.FACTURA
			GO BOTT
			AFACser=scanserie.FACTURA
			
			STORE stitulofacrec+CHR(13)+CHR(13)+PADR("FACTURAS SERIE '"+ALLTRIM(laserfac.serie)+"' DEL "+ALLTRIM(STR(defacser))+" AL "+ALLTRIM(STR(afacser)),40)+PADL(ALLTRIM(STR(totfacser,10,2)),14) TO stitulofacrec
							
		ENDIF
	ENDSCAN		
	
	SELECT distinct serie as serie FROM micurrec INTO CURSOR laserrec
	SELECT laserrec
	SCAN
		IF EMPTY(stitulofacrec)
			SELECT * FROM micurrec WHERE ALLTRIM(serie)==ALLTRIM(laserrec.serie) ORDER BY factura INTO CURSOR scanserie
			SELECT scanserie
			SUM ALL total+propina TO totfacser
			
			SELECT scanserie
			GO TOP
			DEFACser=scanserie.FACTURA
			GO BOTT
			AFACser=scanserie.FACTURA
			
			STORE stitulofacrec+PADR("RECIBOS SERIE '"+ALLTRIM(laserrec.serie)+"' DEL "+ALLTRIM(STR(defacser))+" AL "+ALLTRIM(STR(afacser)),40)+PADL(ALLTRIM(STR(totfacser,10,2)),14) TO stitulofacrec
			
		ELSE
			SELECT * FROM micurrec WHERE ALLTRIM(serie)==ALLTRIM(laserrec.serie) ORDER BY factura INTO CURSOR scanserie
			SELECT scanserie
			SUM ALL total+propina TO totfacser
			
			SELECT scanserie
			GO TOP
			DEFACser=scanserie.FACTURA
			GO BOTT
			AFACser=scanserie.FACTURA
			
			STORE stitulofacrec+CHR(13)+CHR(13)+PADR("RECIBOS SERIE '"+ALLTRIM(laserrec.serie)+"' DEL "+ALLTRIM(STR(defacser))+" AL "+ALLTRIM(STR(afacser)),40)+PADL(ALLTRIM(STR(totfacser,10,2)),14) TO stitulofacrec
							
		ENDIF
	ENDSCAN		
	
	SELECT micurfac
	GO TOP
	DEFACTURA=MICURFAC.FACTURA
	GO BOTT
	AFACTURA=MICURFAC.FACTURA
	
	SELECT micurrec
	GO TOP
	DERECIBO=MICURREC.FACTURA
	GO BOTT
	ARECIBO=MICURREC.FACTURA

	SELECT * FROM comanda  WHERE fecha=fecini ORDER BY comanda INTO CURSOR Lascomandas
		
	xfilcaja=""
	
	SELECT * FROM desglose_efectivo WHERE turno in(SELECT turno FROM turno WHERE CTOD(DTOC(INICIO))=fecini) AND TIPO=2 &xfilcaja INTO CURSOR losretiros
	SELECT * FROM desglose_efectivo WHERE turno in(SELECT turno FROM turno WHERE CTOD(DTOC(INICIO))=fecini) AND TIPO=1 &xfilcaja INTO CURSOR elsaldoini
	SELECT * FROM desglose_efectivo WHERE turno in(SELECT turno FROM turno WHERE CTOD(DTOC(INICIO))=fecini) AND TIPO=4 &xfilcaja INTO CURSOR elsaldofin
	
	SELECT lascomandas
	GO top
	comandaini=lascomandas.comanda
	GO bott
	comandafin=lascomandas.comanda

	STORE "De comanda "+ALLTRIM(STR(comandaini))+" a comanda "+ALLTRIM(STR(comandafin)) TO stitulo2
	STORE "FACTURAS DEL "+ALLTRIM(STR(defactura))+" AL "+ALLTRIM(STR(afactura)) TO stitulo3
	STORE "RECIBOS DEL "+ALLTRIM(STR(derecibo))+" AL "+ALLTRIM(STR(arecibo)) TO stitulo4

	*xcad = "and BETWEEN(A.FECHA,FECINI,FECFIN)"
	xcad = "and A.FECHA=fecini "

	*** FORMAS DE PAGO A DETALLE (CHEQUES Y TARJETAS)
	xfilcajafac=""

	*SELECT * FROM micurfac GROUP BY comanda WHERE !anulada INTO CURSOR Newfac
	IF xverhisto=0
		SELECT * FROM factura GROUP BY comanda WHERE !anulada &xfilcajafac INTO CURSOR Newfac
	ELSE
		SELECT * FROM factura GROUP BY comanda WHERE !anulada &xfilcajafac INTO CURSOR Newfac1
		
		SELECT * FROM hist_factura GROUP BY comanda WHERE !anulada &xfilcajafac INTO CURSOR Newfac2
		
		SELECT * FROM Newfac1 UNION ALL;
		SELECT * FROM Newfac2 GROUP BY comanda ORDER BY comanda INTO CURSOR NewFac 
	ENDIF
	
	xfilcajapag=""
	
	IF xverhisto=0
		** TARJETA  (NECESITA TIPO DE TARJETA PARA QUE LO TOME EN CUENTA DE LO CONTRARIO NO LO INCLUYE)
		SELECT A.FECHA,A.COMANDA,"MASTERCARD" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=1 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad  &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAMASTER
	ELSE
		SELECT A.FECHA,A.COMANDA,"MASTERCARD" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=1 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad  &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAMASTER1
		
		SELECT A.FECHA,A.COMANDA,"MASTERCARD" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM hist_COMANDA A,FORMA_PAGO B, hist_DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,hist_TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=1 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad  &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAMASTER2
		
		SELECT * FROM TARJETAMASTER1 UNION ALL;
		SELECT * FROM TARJETAMASTER2 INTO CURSOR TARJETAMASTER

	ENDIF			
	
	IF xverhisto=0
		SELECT A.FECHA,A.COMANDA,"VISA NET" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=2 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAVISA
	ELSE
		SELECT A.FECHA,A.COMANDA,"VISA NET" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=2 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAVISA1
		
		SELECT A.FECHA,A.COMANDA,"VISA NET" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM hist_COMANDA A,FORMA_PAGO B, hist_DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,hist_TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=2 AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR TARJETAVISA2
		
		SELECT * FROM TARJETAVISA1 UNION ALL;
		SELECT * FROM TARJETAVISA2 INTO CURSOR TARJETAVISA
	ENDIF 

*!*		SELECT A.FECHA,A.COMANDA,"MASTERCARD" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
*!*		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA;
*!*		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, FACTURA F;
*!*		WHERE BETWEEN(A.FECHA,FECINI,FECFIN) AND   A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
*!*		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=1 AND A.COMANDA=F.COMANDA AND !F.ANULADA &xcad  &xcad2 ;
*!*		INTO CURSOR TARJETAMASTER

*!*		
*!*		SELECT A.FECHA,A.COMANDA,"VISA NET" AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.DESCRIPCION AS ENTIDAD,;
*!*		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA;
*!*		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , TIPO_TARJETA  E,TIPO_PAGO_DETALLE D, FACTURA F;
*!*		WHERE BETWEEN(A.FECHA,FECINI,FECFIN) AND   A.COMANDA = C.COMANDA AND C.FORMA_PAGO=3 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
*!*		D.TIPO_TARJETA=E.TIPO_TARJETA AND D.HEADERID=C.ID AND d.tipo_tarjeta=2 AND A.COMANDA=F.COMANDA AND !F.ANULADA &xcad &xcad2 ;
*!*		INTO CURSOR TARJETAVISA

		** CHEQUE NECESITA BANCO PARA QUE LO TOME EN CUENTA DE LO CONTRARIO NO LO INCLUYE)
	IF xverhisto=0
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.NOMBRE AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , BANCO  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=2 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.BANCO=E.BANCO AND D.HEADERID=C.ID AND A.COMANDA=F.COMANDA AND !F.ANULADA  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CHEQUE
	ELSE
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.NOMBRE AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , BANCO  E,TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=2 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.BANCO=E.BANCO AND D.HEADERID=C.ID AND A.COMANDA=F.COMANDA AND !F.ANULADA  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CHEQUE1
		
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.NOMBRE AS ENTIDAD,;
		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM hist_COMANDA A,FORMA_PAGO B, hist_DETALLE_FORMA_PAGO C , BANCO  E,hist_TIPO_PAGO_DETALLE D, Newfac F;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=2 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
		D.BANCO=E.BANCO AND D.HEADERID=C.ID AND A.COMANDA=F.COMANDA AND !F.ANULADA  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CHEQUE2
		
		SELECT * FROM cheque1 UNION all;
		SELECT * FROM cheque2 INTO CURSOR cheque
		
	ENDIF
	
	


*!*		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(D.MONTO+D.PROPINA) AS MONTO,D.PROPINA,D.BOUCHER AS DOCUMENTO,E.NOMBRE AS ENTIDAD,;
*!*		D.V_COMISION,D.V_RETENCION AS V_RET,B.TIPO,B.ORDEN,F.FACTURA;
*!*		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C , BANCO  E,TIPO_PAGO_DETALLE D, FACTURA F;
*!*		WHERE BETWEEN(A.FECHA,FECINI,FECFIN) AND A.COMANDA = C.COMANDA AND C.FORMA_PAGO=2 AND B.FORMA_PAGO=C.FORMA_PAGO AND;
*!*		D.BANCO=E.BANCO AND D.HEADERID=C.ID AND A.COMANDA=F.COMANDA AND !F.ANULADA  &xcad &xcad2 INTO CURSOR CHEQUE

	*** LAS FORMAS DE PAGO QUE NO TIENEN DETALLE

	IF xverhisto=0
*!*				SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,IIF(c.forma_pago=12,C.MONTO+c.propina,c.monto) as monto,C.PROPINA,C.DOCUMENTO,;
*!*				SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA;
*!*				FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, Newfac F ;
*!*				WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO<>2 AND C.FORMA_PAGO<>3 AND C.FORMA_PAGO<>6 ;
*!*				AND B.FORMA_PAGO=C.FORMA_PAGO  ;
*!*				AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
*!*				&xcad &xcad2 &xfilcajapag;
*!*				INTO CURSOR OTROS
		
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(C.MONTO+c.propina) as monto,C.PROPINA,C.DOCUMENTO,;
		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, Newfac F ;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO<>2 AND C.FORMA_PAGO<>3 AND C.FORMA_PAGO<>6 AND C.FORMA_PAGO<>4;
		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		UNION ;
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,(C.MONTOTOT) as monto,C.PROPINA,C.DOCUMENTO,;
		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, Newfac F ;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=4 ;
		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		UNION ;
		SELECT A.FECHA,A.COMANDA,"EFECTIVO" AS DESC,(-1*C.CAMBIO) as monto,0000000000.00 AS PROPINA,C.DOCUMENTO,;
		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO ;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, Newfac F ;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=4 ;
		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR OTROS
	ELSE
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,IIF(c.forma_pago=12,C.MONTO+c.propina,c.monto) as monto,C.PROPINA,C.DOCUMENTO,;
		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, Newfac F ;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO<>2 AND C.FORMA_PAGO<>3 AND C.FORMA_PAGO<>6 ;
		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR OTROS1
		
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,IIF(c.forma_pago=12,C.MONTO+c.propina,c.monto) as monto,C.PROPINA,C.DOCUMENTO,;
		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA,A.IDTOGO;
		FROM hist_COMANDA A,FORMA_PAGO B, hist_DETALLE_FORMA_PAGO C, Newfac F ;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO<>2 AND C.FORMA_PAGO<>3 AND C.FORMA_PAGO<>6 ;
		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		AND A.COMANDA=F.COMANDA AND !F.ANULADA ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR OTROS2
		
		SELECT * FROM otros1 UNION ALL;
		SELECT * FROM otros2 INTO  CURSOR otros
		
	ENDIF

	IF xverhisto=0
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,C.MONTO,C.PROPINA,C.DOCUMENTO,SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,;
		0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,0 AS FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=6 AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CORTESIA
	ELSE
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,C.MONTO,C.PROPINA,C.DOCUMENTO,SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,;
		0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,0 AS FACTURA,A.IDTOGO;
		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=6 AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CORTESIA1
		
		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,C.MONTO,C.PROPINA,C.DOCUMENTO,SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,;
		0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,0 AS FACTURA,A.IDTOGO;
		FROM hist_COMANDA A,FORMA_PAGO B, hist_DETALLE_FORMA_PAGO C;
		WHERE A.COMANDA = C.COMANDA AND C.FORMA_PAGO=6 AND B.FORMA_PAGO=C.FORMA_PAGO  ;
		&xcad &xcad2 &xfilcajapag;
		INTO CURSOR CORTESIA2
		
		SELECT * FROM cortesia1 UNION all;
		SELECT * FROM cortesia2 INTO CURSOR cortesia
		
	ENDIF
	
*!*		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,IIF(c.forma_pago=12,C.MONTO+c.propina,c.monto) as monto,C.PROPINA,C.DOCUMENTO,;
*!*		SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,F.FACTURA;
*!*		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C, FACTURA F ;
*!*		WHERE BETWEEN(A.FECHA,FECINI,FECFIN) AND A.COMANDA = C.COMANDA AND C.FORMA_PAGO<>2 AND C.FORMA_PAGO<>3 AND C.FORMA_PAGO<>6 ;
*!*		AND B.FORMA_PAGO=C.FORMA_PAGO  ;
*!*		AND A.COMANDA=F.COMANDA AND !F.ANULADA &xcad &xcad2;
*!*		INTO CURSOR OTROS

*!*		SELECT A.FECHA,A.COMANDA,B.DESCRIPCION AS DESC,C.MONTO,C.PROPINA,C.DOCUMENTO,SPACE(100) AS ENTIDAD,0000000000.00 AS V_COMISION,;
*!*		0000000000.00 AS  V_RET,B.TIPO,B.ORDEN,0 AS FACTURA;
*!*		FROM COMANDA A,FORMA_PAGO B, DETALLE_FORMA_PAGO C;
*!*		WHERE BETWEEN(A.FECHA,FECINI,FECFIN) AND A.COMANDA = C.COMANDA AND C.FORMA_PAGO=6 AND B.FORMA_PAGO=C.FORMA_PAGO  ;
*!*		&xcad &xcad2;
*!*		INTO CURSOR CORTESIA
	
	SELECT * FROM TARJETAMASTER UNION ALL;
	SELECT * FROM TARJETAVISA UNION ALL;
	SELECT * FROM CHEQUE UNION ALL;
	SELECT * FROM CORTESIA UNION ALL;
	SELECT * FROM OTROS INTO DBF CIERRECAJA ORDER BY 10,3,1

	SELECT a.monto, B.domicilio FROM cierrecaja a INNER JOIN cmdlleva b ON a.comanda=b.comanda WHERE !EMPTY(a.idtogo) AND b.domicilio=1 AND a.tipo<>2 INTO CURSOR cv_domicilio
	SELECT cv_domicilio
	SUM ALL cv_domicilio.monto TO xventa_domicilio
	
	SELECT a.monto, B.domicilio FROM cierrecaja a INNER JOIN cmdlleva b ON a.comanda=b.comanda WHERE !EMPTY(a.idtogo) AND b.domicilio=0 AND a.tipo<>2 INTO CURSOR cv_pasatraer
	SELECT cv_pasatraer
	SUM ALL cv_pasatraer.monto TO xventa_traer
	
	SELECT a.monto FROM cierrecaja a WHERE EMPTY(a.idtogo) AND tipo<>2 INTO CURSOR cv_restaurante
	SELECT cv_restaurante
	SUM ALL cv_restaurante.monto TO xventa_rest
	
	SELECT CIERRECAJA
	
	PUBLIC CANTPER
	SELECT COMENSALES FROM COMANDA WHERE FECHA=fecini INTO CURSOR CURPER
	SUM ALL COMENSALES TO CANTPER
	
	*** CREA CURSOR PARA MOSTRAR TODAS LAS FORMAS DE PAGO SIN IMPORTAR SI TIENEN MOVIMIENTO
	CREATE CURSOR RES_CAJA (FPAGO I,DESCRIPCION C(50),MONTO N(10,2),PROPINA N(10,2),V_COMISION N(10,2),V_RETENCION N(10,2),TIPO N(1), ORDEN N(2), TARJETA N(1))	
	SELECT * FROM FORMA_PAGO  INTO CURSOR CURFPAGO ORDER BY TIPO,ORDEN
	
*!*			SELECT RES_CAJA
*!*			APPEND BLANK
*!*			replace descripcion WITH "SALDO INICIAL"
*!*			replace tipo WITH 1
*!*			replace orden WITH 0
	
	SELECT CURFPAGO
	SCAN
		IF CURFPAGO.FORMA_PAGO=3
			SELECT RES_CAJA
			APPEND BLANK 
			REPLACE DESCRIPCION WITH "MASTERCARD"
			REPLACE TIPO WITH CURFPAGO.TIPO
			SELECT RES_CAJA
			REPLACE FPAGO WITH CURFPAGO.FORMA_PAGO
			REPLACE TARJETA WITH 1
			
			APPEND BLANK 
			REPLACE DESCRIPCION WITH "VISA NET"
			REPLACE TIPO WITH CURFPAGO.TIPO
			REPLACE ORDEN WITH CURFPAGO.ORDEN
			REPLACE FPAGO WITH CURFPAGO.FORMA_PAGO
			REPLACE TARJETA WITH 2
		ELSE
			SELECT RES_CAJA
			APPEND BLANK 
			REPLACE DESCRIPCION WITH CURFPAGO.DESCRIPCION
			REPLACE TIPO WITH CURFPAGO.TIPO
			REPLACE ORDEN WITH CURFPAGO.ORDEN
			REPLACE FPAGO WITH CURFPAGO.FORMA_PAGO
		ENDIF

	ENDSCAN
	
*!*			SELECT RES_CAJA
*!*			APPEND BLANK
*!*			replace descripcion WITH "RETIRO"
*!*			replace tipo WITH 2
*!*			replace orden WITH 99
	*******************************************************************************************
	
	eferet=0.00
	cheret=0.00
	tarret=0.00
	otrret=0.00
	totret=0.00
	
	efefin=0.00
	chefin=0.00
	tarfin=0.00
	otrfin=0.00
	totfin=0.00
	
	totini=0.00
	
	
	SELECT SUM(total-(cheque+tarjeta+otros)) as totalef,SUM(cheque) as totalche, SUM(tarjeta) as totaltar, SUM(otros) as totalotr FROM losretiros INTO CURSOR losretirosres
	SELECT losretirosres
	IF !EOF()
		STORE losretirosres.totalef TO eferet
		STORE losretirosres.totalche TO cheret
		STORE losretirosres.totaltar TO tarret
		STORE losretirosres.totalotr TO otrret
		STORE (losretirosres.totalef+losretirosres.totalche+losretirosres.totaltar+losretirosres.totalotr) TO totret
	ENDIF
	
	SELECT SUM(total) as total FROM elsaldoini INTO CURSOR elsaldoinires
	SELECT elsaldoinires
	IF !EOF()
		STORE elsaldoinires.total TO totini
	ENDIF
	
	SELECT SUM(total-(cheque+tarjeta+otros)) as totalef,SUM(cheque) as totalche, SUM(tarjeta) as totaltar, SUM(otros) as totalotr FROM elsaldofin INTO CURSOR elsaldofinres
	SELECT elsaldofinres
	IF !EOF()
		STORE elsaldofinres.totalef TO efefin
		STORE elsaldofinres.totalche TO chefin
		STORE elsaldofinres.totaltar TO tarfin
		STORE elsaldofinres.totalotr TO otrfin
		STORE (elsaldofinres.totalef+elsaldofinres.totalche+elsaldofinres.totaltar+elsaldofinres.totalotr) TO totfin
	ENDIF
	
	xcoment_corte=""
*!*				SELECT elsaldoinires
*!*				SELECT RES_CAJA
*!*				LOCATE FOR ALLTRIM(descripcion)==ALLTRIM("SALDO INICIAL")
*!*				IF FOUND()
*!*					replace monto WITH elsaldoinires.total
*!*					replace propina WITH 0.00
*!*					replace v_comision WITH 0.00
*!*					replace v_retencion WITH 0.00
*!*				ENDIF
	
	SELECT DESC,SUM(MONTO) AS MONTO,SUM(PROPINA) AS PROPINA,SUM(V_COMISION) AS V_COMISION,SUM(V_RET) AS V_RET,TIPO FROM CIERRECAJA INTO CURSOR CIERRE_CAJA_RES GROUP BY TIPO,DESC ORDER BY TIPO,DESC 
	
*			SET STEP ON 
	
	SELECT CIERRE_CAJA_RES
	SCAN
		SELECT RES_CAJA
		LOCATE FOR ALLTRIM(DESCRIPCION)==ALLTRIM(CIERRE_CAJA_RES.DESC)
		IF FOUND()
			REPLACE MONTO WITH CIERRE_CAJA_RES.MONTO
			REPLACE PROPINA WITH CIERRE_CAJA_RES.PROPINA
			REPLACE V_COMISION WITH CIERRE_CAJA_RES.V_COMISION
			REPLACE V_RETENCION WITH CIERRE_CAJA_RES.V_RET
		ENDIF				
	ENDSCAN
	
*!*				SELECT losretirosres
*!*				SELECT RES_CAJA
*!*				LOCATE FOR ALLTRIM(descripcion)==ALLTRIM("RETIRO")
*!*				IF FOUND()
*!*					replace monto WITH losretirosres.total
*!*					replace propina WITH 0.00
*!*					replace v_comision WITH 0.00
*!*					replace v_retencion WITH 0.00
*!*				ENDIF
	
	efecuadre=0.00
	checuadre=0.00
	tarcuadre=0.00
	otrcuadre=0.00
	totcuadre=0.00
	
	SELECT RES_CAJA
	SCAN
		DO CASE
			CASE ALLTRIM(DESCRIPCION)==ALLTRIM("EFECTIVO")
				efecuadre=efecuadre+RES_CAJA.monto &&+RES_CAJA.propina
				totcuadre=totcuadre+RES_CAJA.monto &&+RES_CAJA.propina
				
			CASE ALLTRIM(DESCRIPCION)==ALLTRIM("CHEQUE")
				checuadre=checuadre+RES_CAJA.monto &&+RES_CAJA.propina
				totcuadre=totcuadre+RES_CAJA.monto &&+RES_CAJA.propina
				
			CASE ALLTRIM(DESCRIPCION)==ALLTRIM("MASTERCARD") OR ALLTRIM(DESCRIPCION)==ALLTRIM("VISA NET")
				tarcuadre=tarcuadre+RES_CAJA.monto &&+RES_CAJA.propina
				totcuadre=totcuadre+RES_CAJA.monto &&+RES_CAJA.propina
				
			OTHERWISE
				IF ALLTRIM(DESCRIPCION)==ALLTRIM("DOLARES")
					otrcuadre=otrcuadre+RES_CAJA.monto &&+RES_CAJA.propina
					totcuadre=totcuadre+RES_CAJA.monto &&+RES_CAJA.propina
				ENDIF
				
		ENDCASE
	ENDSCAN
	
	*----* Cuadrar total
	IF totfin=(totcuadre+totini)-totret
		xcoment_tot=1
	ELSE
		xcoment_tot=0
	ENDIF
	
	*----* Cuadrar efectivo
	IF efefin=(efecuadre+totini)-eferet
		xcoment_efe=1
	ELSE
		xcoment_efe=0
	ENDIF
	
	*----* Cuadrar cheque
	IF chefin=(checuadre-cheret)
		xcoment_che=1
	ELSE
		xcoment_che=0
	ENDIF
	
	*----* Cuadrar tarjeta
	IF tarfin=(tarcuadre-tarret)
		xcoment_tar=1
	ELSE
		xcoment_tar=0
	ENDIF
	
	*----* Cuadrar otros
	IF otrfin=(otrcuadre-otrret)
		xcoment_otr=1
	ELSE
		xcoment_otr=0
	ENDIF
	
	*SET STEP ON
	SELECT RES_CAJA
		
*!*				REPORT FORM cierre_caja_RES TO PRINTER PREVIEW 
	*DO FORM imprime WITH "cierre_caja_res
	
	SELECT CORTE_MES
	APPEND BLANK
	REPLACE FECHA WITH FECINI
	replace deposito WITH efefin
	replace m_tarjeta WITH tarfin
	replace m_dolares WITH otrfin
	replace tot_manual WITH totfin
	replace vrest WITH xventa_rest
	replace vdomicilio WITH xventa_domicilio
	replace vtraer WITH xventa_traer
	replace fac_del WITH defactura
	replace fac_al WITH afactura
	replace emitidas WITH afactura-defactura
	
	SELECT RES_CAJA
	SCAN
		DO CASE
			CASE FPAGO=1	&&EFECTIVO
				SELECT CORTE_MES
				REPLACE SYS_EFECTIVO WITH RES_CAJA.MONTO
				REPLACE PROPINA WITH PROPINA+RES_CAJA.PROPINA
				
			CASE FPAGO=3 AND TARJETA=1	&&CREDOMATIC
				SELECT comision,retencion FROM tipo_tarjeta WHERE tipo_tarjeta=1 INTO CURSOR dcredo
						
				SELECT CORTE_MES
				REPLACE V_CREDO WITH RES_CAJA.MONTO
				REPLACE C_CREDO WITH ROUND(RES_CAJA.MONTO*(DCREDO.COMISION/100),2)
				REPLACE R_CREDO WITH ROUND((RES_CAJA.MONTO/1.12)*.12*(DCREDO.RETENCION/100),2)
				REPLACE L_CREDO WITH V_CREDO-C_CREDO-R_CREDO
				REPLACE PROPINA WITH PROPINA+RES_CAJA.PROPINA
				REPLACE PRO_CREDO WITH PRO_CREDO+RES_CAJA.PROPINA
				REPLACE VB_CREDO WITH V_CREDO-PRO_CREDO
				REPLACE IVA_CREDO WITH (V_CREDO/1.12)*0.12
				
			CASE FPAGO=3 AND TARJETA=2	&&VISA
				SELECT comision,retencion FROM tipo_tarjeta WHERE tipo_tarjeta=2 INTO CURSOR dvisa
				
				SELECT CORTE_MES
				REPLACE V_VISA WITH RES_CAJA.MONTO
				REPLACE C_VISA WITH ROUND(RES_CAJA.MONTO*(DCREDO.COMISION/100),2)
				REPLACE R_VISA WITH ROUND((RES_CAJA.MONTO/1.12)*.12*(DCREDO.RETENCION/100),2)
				REPLACE L_VISA WITH V_VISA-C_VISA-R_VISA
				REPLACE PROPINA WITH PROPINA+RES_CAJA.PROPINA
				REPLACE PRO_VISA WITH PRO_VISA+RES_CAJA.PROPINA
				REPLACE VB_VISA WITH V_VISA-PRO_VISA
				REPLACE IVA_VISA WITH (V_VISA/1.12)*0.12
				
			CASE FPAGO=4	&&DOLARES
				SELECT CORTE_MES
				REPLACE SYS_DOLAR WITH RES_CAJA.MONTO
				REPLACE PROPINA WITH PROPINA+RES_CAJA.PROPINA
			CASE FPAGO=12	&&CREDITO
				SELECT CORTE_MES
				REPLACE CREDITO WITH RES_CAJA.MONTO
			CASE FPAGO=13	&&DESCUENTO
				SELECT CORTE_MES
				REPLACE DESCUENTO WITH RES_CAJA.MONTO
			CASE FPAGO=17	&&EXENCION
				SELECT CORTE_MES
				REPLACE EXENCION WITH RES_CAJA.MONTO
		ENDCASE
	ENDSCAN
	
	SELECT CORTE_MES
	REPLACE TOT_SYS WITH SYS_EFECTIVO+SYS_DOLAR+V_CREDO+V_VISA+CREDITO
	REPLACE VENTA_BRUTA WITH TOT_SYS
	REPLACE VENTA_NETA WITH TOT_SYS/1.12
	REPLACE IVA WITH VENTA_NETA*0.12
	REPLACE VENTA_NETA2 WITH (VENTA_BRUTA-PROPINA-CREDITO)/1.12
	REPLACE DIFERENCIA WITH TOT_SYS-TOT_MANUAL
	
	FECINI = FECINI+1
	
	SELECT res_caja
	DELETE ALL
ENDDO


SELECT CORTE_MES

SELECT fecha, sys_efectivo, sys_dolar, v_credo, v_visa, ;
	factura_manual, dif_sys, credito as cortesias, tot_sys, deposito, m_dolares, m_tarjeta, descuento, exencion, credito, tot_manual, diferencia, ;
	propina, venta_bruta, iva, venta_neta, venta_neta2, fac_del, fac_al, emitidas, vrest, vdomicilio, vtraer FROM corte_mes INTO CURSOR elcorte
	
SELECT fecha, v_credo as venta, pro_credo as propina, vb_credo as venta_bruta, iva_credo as iva, c_credo as comision, r_credo as retencion, l_credo as liquido FROM corte_mes INTO CURSOR elcortecredo

SELECT fecha, v_visa as venta, pro_visa as propina, vb_visa as venta_bruta, iva_visa as iva, c_visa as comision, r_visa as retencion, l_visa as liquido FROM corte_mes INTO CURSOR elcortevisa
	
DO FORM avisobox WITH "Seleccione donde guardar el Corte General"

SELECT elcorte
Public quenombre
Do Form PideArch
quenombre="'"+ALLTRIM(quenombre)+"'"
SELECT elcorte
EXPORT TO &quenombre TYPE xl5

DO FORM avisobox WITH "Seleccione donde guardar el Corte de Credomatic"

SELECT elcorte
Public quenombre
Do Form PideArch
quenombre="'"+ALLTRIM(quenombre)+"'"
SELECT elcortecredo
EXPORT TO &quenombre TYPE xl5

DO FORM avisobox WITH "Seleccione donde guardar el Corte de Visa"

SELECT elcorte
Public quenombre
Do Form PideArch
quenombre="'"+ALLTRIM(quenombre)+"'"
SELECT elcortevisa
EXPORT TO &quenombre TYPE xl5

